XDK_HOME = @abs_top_builddir@
XDK_BASE = $(XDK_HOME)
XDK_NUMA_FLAG = @numa_flag@
XDK_NUMA_LIB = @numa_lib@
XDK_INCLUDES = -I$(XDK_BASE)/lib/libexo -I$(XDK_BASE)/lib/libcomponent -I$(XDK_BASE)/lib/libcommon
XDK_LIBS = -L$(XDK_BASE)/lib/libexo -L$(XDK_BASE)/lib/libcomponent -L$(XDK_BASE)/lib/libcommon -lcomponent -lexo -lcommon

COBJS   = $(addprefix obj/,$(subst .c,.o,$(filter %.c,$(SOURCES)))) 
CXXOBJS = $(addprefix obj/,$(subst .cc,.o,$(filter %.cc,$(SOURCES))))
OBJS = $(CXXOBJS) $(COBJS)

all:

# emacs tags (for you emacs lovers out there!)
#
etags:
	etags $(SOURCES) *.h $(HOME)/xdk/lib/libexo/*.cc $(HOME)/xdk/lib/libexo/exo/*.h

# valgrind memcheck
#
memcheck:
ifeq ($(P),"")
	@echo "Please do 'make memcheck P' where P is the binary to check"
else
	valgrind --tool=memcheck --leak-check=full $(P)
endif

# makedepend defines rules for header dependencies so
# when you edit a header file you don't need to do
# a make clean; must have 'makedepend' tool installed
#
depend:
	makedepend -pobj/ -o.o -I./ -- -- $(SOURCES)

# general build rule for C++
#
obj/%.o:%.cc
	@mkdir -p obj	
	g++ -c -o $@ $(notdir $<) $(CXXFLAGS) $(XDK_NUMA_FLAG)

# general build rule for C
#
obj/%.o:%.c
	@mkdir -p obj	
	gcc -c -o $@ $(notdir $<) $(CFLAGS) $(XDK_NUMA_FLAG)

.PHONY: depend memcheck etags run_coverity


